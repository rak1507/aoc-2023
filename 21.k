N:#i:0:`:i/21.txt; s:*,/(!#i){x,'&y}'i="S"
step:{d@&~"#"=i ./:.q.mod[;#i]d:?,/(0 -1;0 1;1 0;-1 0)+/:\:x}
r:{s::`u#();x#,/+\2#'0N 2##:'x{s,:x;n@&~in[;s]n@:&~"#"=i ./:.q.mod[;N]n:?,/(0 -1;0 1;1 0;-1 0)+/:\:x}\y}[800;,s]
k:4*N; R:k_r; O:{(z-y)-y-x}. R@0,N,2*N
{m:.q.mod[x-k;N]; d:--/R@m,m+N; q:(x-k)div N; (d*q)+(R m)+O*(q*q-1) div 2}'64 26501365
